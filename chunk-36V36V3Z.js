import{a as Z}from"./chunk-L5LXN47X.js";import{a as lt,b as nt,c as ot,d as it,e as rt,f as at,g as st}from"./chunk-I2XKUEJU.js";import{$ as h,Bb as U,Cb as W,D as A,Gb as R,Ha as q,Ia as l,Ja as m,Lb as g,Ma as M,N,Na as y,O as P,Oa as c,Pa as a,Qa as s,R as T,Ra as u,Va as w,Xa as _,Y as V,Yb as J,Za as p,Zb as K,aa as b,bd as S,dd as Y,e as pt,fd as tt,gd as et,ic as E,k as F,kb as G,lc as Q,mb as d,na as r,nb as B,ob as O,p as I,qc as X,s as $,sb as z,t as j,tb as H,ub as f,va as x,xb as D,yb as k,zb as L}from"./chunk-4OSKGQCA.js";var C=pt(lt());var ut=t=>[t,51.2,.4,51.8],_t=()=>({padding:40}),ft=()=>({preserveDrawingBuffer:!0}),gt=()=>({enableHighAccuracy:!0}),Ct=(t,o)=>[t,o],vt=(t,o)=>o.id;function ht(t,o){if(t&1&&d(0),t&2){let e=p().$implicit;O(" ",e.stopLetter," ")}}function bt(t,o){t&1&&(a(0,"mat-icon"),d(1,"directions_bus"),s())}function xt(t,o){if(t&1){let e=w();a(0,"mgl-marker",4)(1,"div",5),_("click",function(){let i=h(e).$implicit,v=p();return b(v.click(i.id))}),l(2,ht,1,1)(3,bt,2,0,"mat-icon"),s()()}if(t&2){let e=o.$implicit;c("lngLat",L(2,Ct,e.longitude,e.latitude)),r(2),m(e.stopLetter?2:3)}}var ct=(()=>{class t{stops=g.required();bounds=R(()=>{let e=this.stops().map(n=>[n.longitude,n.latitude,n.longitude,n.latitude]).reduce(t.getBounds);return new C.LngLatBounds(new C.LngLat(e[0],e[1]),new C.LngLat(e[2],e[3]))});map=null;click(e){console.log("Clicking stop",e)}static getBounds(e,n){return[Math.min(e[0],n[0]),Math.min(e[1],n[1]),Math.max(e[2],n[2]),Math.max(e[3],n[3])]}static \u0275fac=function(n){return new(n||t)};static \u0275cmp=x({type:t,selectors:[["app-route-map"]],inputs:{stops:[1,"stops"]},decls:6,vars:14,consts:[[3,"mapLoad","maxBounds","fitBounds","fitBoundsOptions","attributionControl","canvasContextAttributes"],["mglAttribution","","position","top-right",3,"compact"],["mglGeolocate","","position","bottom-right",3,"positionOptions"],["mglNavigation","","position","bottom-right"],[3,"lngLat"],[1,"marker",3,"click"]],template:function(n,i){n&1&&(a(0,"mgl-map",0),_("mapLoad",function(dt){return i.map=dt}),u(1,"mgl-control",1)(2,"mgl-control",2)(3,"mgl-control",3),M(4,xt,4,5,"mgl-marker",4,vt),s()),n&2&&(G("https://tiles.openfreemap.org/styles/bright"),c("maxBounds",k(9,ut,-.7))("fitBounds",i.bounds())("fitBoundsOptions",D(11,_t))("attributionControl",!1)("canvasContextAttributes",D(12,ft)),r(),c("compact",!0),r(),c("positionOptions",D(13,gt)),r(2),y(i.stops()))},dependencies:[ot,nt,it,at,st,S,rt],styles:["mgl-map[_ngcontent-%COMP%]{width:100%;height:100%}.marker[_ngcontent-%COMP%]{min-width:3em;height:3em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:50%;font-size:.8em}"]})}return t})();var Mt=t=>["../",t],yt=(t,o)=>["/stop",t,o],wt=(t,o)=>o.id;function Ot(t,o){t&1&&(a(0,"a",5)(1,"mat-icon"),d(2,"compare_arrows"),s()())}function Dt(t,o){if(t&1&&(a(0,"a",8),u(1,"app-bus-stop",9),s()),t&2){let e=o.$implicit;p(3);let n=f(0);c("routerLink",L(2,yt,e.id,n.data.lineId)),r(),c("stop",e)}}function kt(t,o){if(t&1&&(a(0,"a",1)(1,"div",2),d(2),s(),a(3,"div",3)(4,"div",4)(5,"small"),d(6,"from"),s(),a(7,"div"),d(8),s()(),l(9,Ot,3,0,"a",5),a(10,"div",4)(11,"small"),d(12,"to"),s(),a(13,"div"),d(14),s()()()(),u(15,"app-route-map",6),a(16,"div",7),M(17,Dt,2,5,"a",8,wt),s()),t&2){let e=p(2),n=f(0);c("routerLink",n.data.isOutboundOnly?null:k(7,Mt,e.reverseDirection())),q("title",n.data.isOutboundOnly?null:"Switch route direction"),r(2),O(" ",n.data.lineName," "),r(6),B(n.data.from),r(),m(n.data.isOutboundOnly?-1:9),r(5),B(n.data.to),r(),c("stops",n.data.stops),r(2),y(n.data.stops)}}function Lt(t,o){t&1&&u(0,"app-loading")}function Rt(t,o){if(t&1){let e=w();a(0,"app-error",10),_("onRefresh",function(){h(e);let i=p(2);return b(i.refresherSubject.next())}),s()}if(t&2){p(2);let e=f(0);c("errorData",e.error)}}function St(t,o){if(t&1&&l(0,kt,19,9)(1,Lt,1,0,"app-loading")(2,Rt,1,1,"app-error",0),t&2){p();let e=f(0);m(e.state==="done"?0:e.state==="loading"?1:e.state==="error"?2:-1)}}var Qt=(()=>{class t{busRouteService=V(Z);routeId=g.required();routeId$=E(this.routeId);direction=g.required();direction$=E(this.direction);reverseDirection=R(()=>this.direction()==="outbound"?"inbound":"outbound");refresherSubject=new F(void 0);refresher$=this.refresherSubject.asObservable().pipe(T(e=>console.log("refreshing")));viewModel$=this.refresher$.pipe(P(e=>j([this.routeId$,this.direction$])),T(e=>console.log("Latest values",e)),P(([e,n])=>this.busRouteService.details(e,n).pipe($(i=>({state:"done",data:i})),A(i=>(console.error("Unable to find route details",i),I({state:"error",error:i}))),N({state:"loading"}))));static \u0275fac=function(n){return new(n||t)};static \u0275cmp=x({type:t,selectors:[["app-bus-route-details"]],inputs:{routeId:[1,"routeId"],direction:[1,"direction"]},decls:3,vars:4,consts:[[3,"errorData"],[1,"header",3,"routerLink"],[1,"badge"],[1,"destinations"],[1,"destination"],[1,"reverse"],[3,"stops"],[1,"content"],[3,"routerLink"],[3,"stop"],[3,"onRefresh","errorData"]],template:function(n,i){if(n&1&&(z(0),U(1,"async"),l(2,St,3,1)),n&2){let v=H(W(1,1,i.viewModel$));r(2),m(v?2:-1)}},dependencies:[et,K,S,X,Q,Y,tt,ct,J],styles:[".header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:1em;margin-bottom:2em;color:#000;text-decoration:none}.header[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{min-width:3em;height:2em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:.5em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:1em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .destination[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:700;word-break:break-word}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .reverse[_ngcontent-%COMP%]{display:flex;color:#fff;background-color:#195b92;padding:.3em;border-radius:50%}app-route-map[_ngcontent-%COMP%]{display:block;width:100%;height:500px}.content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:.7em 0;display:block}.content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:inherit}"]})}return t})();export{Qt as RouteDetailsComponent};

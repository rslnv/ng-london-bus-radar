import{a as ee}from"./chunk-FWKNEKYG.js";import{a as ge,b as ne,c as ie,d as re,e as ae,f as ce,g as se,h as pe,i as de,j as le}from"./chunk-R25AMFRN.js";import{$ as v,$b as Q,Ab as L,Cb as H,D as j,Db as U,Hb as S,Ia as q,Ib as W,Ja as u,Ka as _,Mb as f,N as A,Na as M,O as P,Oa as y,Pa as s,Qa as a,R as F,Ra as c,Sa as m,Wa as w,Y as V,Ya as O,_a as d,_b as K,aa as b,dd as k,e as _e,fd as Z,hd as te,id as oe,k as I,kc as T,lb as G,na as r,nb as p,nc as X,ob as E,p as $,pb as D,s as B,sc as Y,t as N,tb as J,ub as z,va as x,vb as C,yb as g,zb as h}from"./chunk-NVYEZAQB.js";var R=_e(ge());var Ce=e=>[e,51.2,.4,51.8],he=()=>({padding:40}),ve=()=>({preserveDrawingBuffer:!0}),be=()=>({enableHighAccuracy:!0}),xe=e=>({type:"LineString",coordinates:e}),Me=()=>({"line-join":"round","line-cap":"round"}),ye=()=>({"line-color":"#195b92","line-width":5}),we=(e,n)=>[e,n],Oe=(e,n)=>n.id;function De(e,n){if(e&1&&p(0),e&2){let t=d().$implicit;D(" ",t.stopLetter," ")}}function Le(e,n){e&1&&(a(0,"mat-icon"),p(1,"directions_bus"),c())}function Se(e,n){if(e&1){let t=w();a(0,"mgl-marker",7)(1,"div",8),O("click",function(){let i=v(t).$implicit,l=d();return b(l.click(i.id))}),u(2,De,1,1)(3,Le,2,0,"mat-icon"),c()()}if(e&2){let t=n.$implicit;s("lngLat",L(2,we,t.longitude,t.latitude)),r(2),_(t.stopLetter?2:3)}}var me=(()=>{class e{stops=f.required();bounds=S(()=>{let t=this.stops()[0].longitude,o=this.stops()[0].latitude,i=new R.LngLat(t,o);return this.stops().map(l=>[l.longitude,l.latitude]).reduce((l,ue)=>l.extend(ue),new R.LngLatBounds(i,i))});path=f.required();foo=W(()=>console.log("path",JSON.stringify(this.path())));click(t){console.log("Clicking stop",t)}static \u0275fac=function(o){return new(o||e)};static \u0275cmp=x({type:e,selectors:[["app-route-map"]],inputs:{stops:[1,"stops"],path:[1,"path"]},decls:9,vars:21,consts:[[3,"maxBounds","fitBounds","fitBoundsOptions","attributionControl","canvasContextAttributes"],["mglAttribution","","position","top-right",3,"compact"],["mglGeolocate","","position","bottom-right",3,"positionOptions"],["mglNavigation","","position","bottom-right"],["id","pathSource"],[3,"geometry"],["id","route","type","line","source","pathSource",3,"layout","paint"],[3,"lngLat"],[1,"marker",3,"click"]],template:function(o,i){o&1&&(a(0,"mgl-map",0),m(1,"mgl-control",1)(2,"mgl-control",2)(3,"mgl-control",3),a(4,"mgl-geojson-source",4),m(5,"mgl-feature",5),c(),m(6,"mgl-layer",6),M(7,Se,4,5,"mgl-marker",7,Oe),c()),o&2&&(G("https://tiles.openfreemap.org/styles/bright"),s("maxBounds",h(12,Ce,-.7))("fitBounds",i.bounds())("fitBoundsOptions",g(14,he))("attributionControl",!1)("canvasContextAttributes",g(15,ve)),r(),s("compact",!0),r(),s("positionOptions",g(16,be)),r(3),s("geometry",h(17,xe,i.path())),r(),s("layout",g(19,Me))("paint",g(20,ye)),r(),y(i.stops()))},dependencies:[ie,ne,se,ce,re,pe,de,le,k,ae],styles:["mgl-map[_ngcontent-%COMP%]{width:100%;height:100%}.marker[_ngcontent-%COMP%]{min-width:3em;height:3em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:50%;font-size:.8em}"]})}return e})();var ke=e=>["../",e],Re=(e,n)=>["/stop",e,n],Pe=(e,n)=>n.id;function Fe(e,n){e&1&&(a(0,"a",5)(1,"mat-icon"),p(2,"compare_arrows"),c()())}function Ee(e,n){if(e&1&&(a(0,"a",8),m(1,"app-bus-stop",9),c()),e&2){let t=n.$implicit;d(3);let o=C(0);s("routerLink",L(2,Re,t.id,o.data.lineId)),r(),s("stop",t)}}function Te(e,n){if(e&1&&(a(0,"a",1)(1,"div",2),p(2),c(),a(3,"div",3)(4,"div",4)(5,"small"),p(6,"from"),c(),a(7,"div"),p(8),c()(),u(9,Fe,3,0,"a",5),a(10,"div",4)(11,"small"),p(12,"to"),c(),a(13,"div"),p(14),c()()()(),m(15,"app-route-map",6),a(16,"div",7),M(17,Ee,2,5,"a",8,Pe),c()),e&2){let t=d(2),o=C(0);s("routerLink",o.data.isOutboundOnly?null:h(8,ke,t.reverseDirection())),q("title",o.data.isOutboundOnly?null:"Switch route direction"),r(2),D(" ",o.data.lineName," "),r(6),E(o.data.from),r(),_(o.data.isOutboundOnly?-1:9),r(5),E(o.data.to),r(),s("stops",o.data.stops)("path",o.data.path),r(2),y(o.data.stops)}}function Ie(e,n){e&1&&m(0,"app-loading")}function $e(e,n){if(e&1){let t=w();a(0,"app-error",10),O("onRefresh",function(){v(t);let i=d(2);return b(i.refresherSubject.next())}),c()}if(e&2){d(2);let t=C(0);s("errorData",t.error)}}function Be(e,n){if(e&1&&u(0,Te,19,10)(1,Ie,1,0,"app-loading")(2,$e,1,1,"app-error",0),e&2){d();let t=C(0);_(t.state==="done"?0:t.state==="loading"?1:t.state==="error"?2:-1)}}var nt=(()=>{class e{busRouteService=V(ee);routeId=f.required();routeId$=T(this.routeId);direction=f.required();direction$=T(this.direction);reverseDirection=S(()=>this.direction()==="outbound"?"inbound":"outbound");refresherSubject=new I(void 0);refresher$=this.refresherSubject.asObservable().pipe(F(t=>console.log("refreshing")));viewModel$=this.refresher$.pipe(P(t=>N([this.routeId$,this.direction$])),F(t=>console.log("Latest values",t)),P(([t,o])=>this.busRouteService.details(t,o).pipe(B(i=>({state:"done",data:i})),j(i=>(console.error("Unable to find route details",i),$({state:"error",error:i}))),A({state:"loading"}))));static \u0275fac=function(o){return new(o||e)};static \u0275cmp=x({type:e,selectors:[["app-bus-route-details"]],inputs:{routeId:[1,"routeId"],direction:[1,"direction"]},decls:3,vars:4,consts:[[3,"errorData"],[1,"header",3,"routerLink"],[1,"badge"],[1,"destinations"],[1,"destination"],[1,"reverse"],[3,"stops","path"],[1,"content"],[3,"routerLink"],[3,"stop"],[3,"onRefresh","errorData"]],template:function(o,i){if(o&1&&(J(0),H(1,"async"),u(2,Be,3,1)),o&2){let l=z(U(1,1,i.viewModel$));r(2),_(l?2:-1)}},dependencies:[oe,Q,k,Y,X,Z,te,me,K],styles:[".header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:1em;margin-bottom:2em;color:#000;text-decoration:none}.header[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{min-width:3em;height:2em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:.5em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:1em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .destination[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:700;word-break:break-word}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .reverse[_ngcontent-%COMP%]{display:flex;color:#fff;background-color:#195b92;padding:.3em;border-radius:50%}app-route-map[_ngcontent-%COMP%]{display:block;width:100%;height:500px}.content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:.7em 0;display:block}.content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:inherit}"]})}return e})();export{nt as RouteDetailsComponent};

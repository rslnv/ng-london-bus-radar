import{a as tt}from"./chunk-L5LXN47X.js";import{a as lt,b as nt,c as it,d as rt,e as at,f as st,g as ct}from"./chunk-I2XKUEJU.js";import{$ as v,Bb as W,Cb as J,D as A,Gb as k,Ha as G,Ia as m,Ja as u,Lb as C,Ma as x,N as V,Na as M,O as T,Oa as c,Pa as a,Qa as s,R as E,Ra as _,Va as y,Xa as f,Y as q,Yb as K,Za as l,Zb as Q,aa as b,bd as R,dd as Z,e as dt,fd as et,gd as ot,ic as I,k as $,kb as z,lc as X,mb as p,na as r,nb as F,ob as w,p as B,qc as Y,s as j,sb as H,t as N,tb as U,ub as g,va as h,xb as O,yb as L,zb as D}from"./chunk-4OSKGQCA.js";var S=dt(lt());var ut=t=>[t,51.2,.4,51.8],_t=()=>({padding:40}),ft=()=>({preserveDrawingBuffer:!0}),gt=()=>({enableHighAccuracy:!0}),Ct=(t,n)=>[t,n],vt=(t,n)=>n.id;function bt(t,n){if(t&1&&p(0),t&2){let e=l().$implicit;w(" ",e.stopLetter," ")}}function ht(t,n){t&1&&(a(0,"mat-icon"),p(1,"directions_bus"),s())}function xt(t,n){if(t&1){let e=y();a(0,"mgl-marker",4)(1,"div",5),f("click",function(){let i=v(e).$implicit,d=l();return b(d.click(i.id))}),m(2,bt,1,1)(3,ht,2,0,"mat-icon"),s()()}if(t&2){let e=n.$implicit;c("lngLat",D(2,Ct,e.longitude,e.latitude)),r(2),u(e.stopLetter?2:3)}}var pt=(()=>{class t{stops=C.required();bounds=k(()=>{let e=this.stops()[0].longitude,o=this.stops()[0].latitude,i=new S.LngLat(e,o);return this.stops().map(d=>[d.longitude,d.latitude]).reduce((d,P)=>d.extend(P),new S.LngLatBounds(i,i))});map=null;click(e){console.log("Clicking stop",e)}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=h({type:t,selectors:[["app-route-map"]],inputs:{stops:[1,"stops"]},decls:6,vars:14,consts:[[3,"mapLoad","maxBounds","fitBounds","fitBoundsOptions","attributionControl","canvasContextAttributes"],["mglAttribution","","position","top-right",3,"compact"],["mglGeolocate","","position","bottom-right",3,"positionOptions"],["mglNavigation","","position","bottom-right"],[3,"lngLat"],[1,"marker",3,"click"]],template:function(o,i){o&1&&(a(0,"mgl-map",0),f("mapLoad",function(P){return i.map=P}),_(1,"mgl-control",1)(2,"mgl-control",2)(3,"mgl-control",3),x(4,xt,4,5,"mgl-marker",4,vt),s()),o&2&&(z("https://tiles.openfreemap.org/styles/bright"),c("maxBounds",L(9,ut,-.7))("fitBounds",i.bounds())("fitBoundsOptions",O(11,_t))("attributionControl",!1)("canvasContextAttributes",O(12,ft)),r(),c("compact",!0),r(),c("positionOptions",O(13,gt)),r(2),M(i.stops()))},dependencies:[it,nt,rt,st,ct,R,at],styles:["mgl-map[_ngcontent-%COMP%]{width:100%;height:100%}.marker[_ngcontent-%COMP%]{min-width:3em;height:3em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:50%;font-size:.8em}"]})}return t})();var Mt=t=>["../",t],yt=(t,n)=>["/stop",t,n],wt=(t,n)=>n.id;function Ot(t,n){t&1&&(a(0,"a",5)(1,"mat-icon"),p(2,"compare_arrows"),s()())}function Lt(t,n){if(t&1&&(a(0,"a",8),_(1,"app-bus-stop",9),s()),t&2){let e=n.$implicit;l(3);let o=g(0);c("routerLink",D(2,yt,e.id,o.data.lineId)),r(),c("stop",e)}}function Dt(t,n){if(t&1&&(a(0,"a",1)(1,"div",2),p(2),s(),a(3,"div",3)(4,"div",4)(5,"small"),p(6,"from"),s(),a(7,"div"),p(8),s()(),m(9,Ot,3,0,"a",5),a(10,"div",4)(11,"small"),p(12,"to"),s(),a(13,"div"),p(14),s()()()(),_(15,"app-route-map",6),a(16,"div",7),x(17,Lt,2,5,"a",8,wt),s()),t&2){let e=l(2),o=g(0);c("routerLink",o.data.isOutboundOnly?null:L(7,Mt,e.reverseDirection())),G("title",o.data.isOutboundOnly?null:"Switch route direction"),r(2),w(" ",o.data.lineName," "),r(6),F(o.data.from),r(),u(o.data.isOutboundOnly?-1:9),r(5),F(o.data.to),r(),c("stops",o.data.stops),r(2),M(o.data.stops)}}function kt(t,n){t&1&&_(0,"app-loading")}function Rt(t,n){if(t&1){let e=y();a(0,"app-error",10),f("onRefresh",function(){v(e);let i=l(2);return b(i.refresherSubject.next())}),s()}if(t&2){l(2);let e=g(0);c("errorData",e.error)}}function St(t,n){if(t&1&&m(0,Dt,19,9)(1,kt,1,0,"app-loading")(2,Rt,1,1,"app-error",0),t&2){l();let e=g(0);u(e.state==="done"?0:e.state==="loading"?1:e.state==="error"?2:-1)}}var Qt=(()=>{class t{busRouteService=q(tt);routeId=C.required();routeId$=I(this.routeId);direction=C.required();direction$=I(this.direction);reverseDirection=k(()=>this.direction()==="outbound"?"inbound":"outbound");refresherSubject=new $(void 0);refresher$=this.refresherSubject.asObservable().pipe(E(e=>console.log("refreshing")));viewModel$=this.refresher$.pipe(T(e=>N([this.routeId$,this.direction$])),E(e=>console.log("Latest values",e)),T(([e,o])=>this.busRouteService.details(e,o).pipe(j(i=>({state:"done",data:i})),A(i=>(console.error("Unable to find route details",i),B({state:"error",error:i}))),V({state:"loading"}))));static \u0275fac=function(o){return new(o||t)};static \u0275cmp=h({type:t,selectors:[["app-bus-route-details"]],inputs:{routeId:[1,"routeId"],direction:[1,"direction"]},decls:3,vars:4,consts:[[3,"errorData"],[1,"header",3,"routerLink"],[1,"badge"],[1,"destinations"],[1,"destination"],[1,"reverse"],[3,"stops"],[1,"content"],[3,"routerLink"],[3,"stop"],[3,"onRefresh","errorData"]],template:function(o,i){if(o&1&&(H(0),W(1,"async"),m(2,St,3,1)),o&2){let d=U(J(1,1,i.viewModel$));r(2),u(d?2:-1)}},dependencies:[ot,Q,R,Y,X,Z,et,pt,K],styles:[".header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:1em;margin-bottom:2em;color:#000;text-decoration:none}.header[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{min-width:3em;height:2em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:.5em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:1em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .destination[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:700;word-break:break-word}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .reverse[_ngcontent-%COMP%]{display:flex;color:#fff;background-color:#195b92;padding:.3em;border-radius:50%}app-route-map[_ngcontent-%COMP%]{display:block;width:100%;height:500px}.content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:.7em 0;display:block}.content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:inherit}"]})}return t})();export{Qt as RouteDetailsComponent};

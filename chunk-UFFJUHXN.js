import{a as Z}from"./chunk-L5LXN47X.js";import{a as lt,b as nt,c as ot,d as it,e as rt,f as at,g as st}from"./chunk-I2XKUEJU.js";import{$ as h,Bb as U,Cb as W,D as N,Gb as R,Ha as q,Ia as l,Ja as m,Lb as f,Ma as M,N as A,Na as L,O as P,Oa as c,Pa as a,Qa as s,R as B,Ra as u,Va as w,Xa as _,Y as V,Yb as J,Za as p,Zb as K,aa as x,bd as S,dd as Y,e as pt,fd as tt,gd as et,ic as E,k as F,kb as G,lc as Q,mb as d,na as r,nb as T,ob as y,p as I,qc as X,s as $,sb as z,t as j,tb as H,ub as g,va as b,xb as O,yb as D,zb as k}from"./chunk-4OSKGQCA.js";var C=pt(lt());var ut=e=>[e,51.2,.4,51.8],_t=()=>({padding:40}),gt=()=>({preserveDrawingBuffer:!0}),ft=()=>({enableHighAccuracy:!0}),Ct=(e,o)=>[e,o],vt=(e,o)=>o.id;function ht(e,o){if(e&1&&d(0),e&2){let t=p().$implicit;y(" ",t.stopLetter," ")}}function xt(e,o){e&1&&(a(0,"mat-icon"),d(1,"directions_bus"),s())}function bt(e,o){if(e&1){let t=w();a(0,"mgl-marker",4)(1,"div",5),_("click",function(){let i=h(t).$implicit,v=p();return x(v.click(i.id))}),l(2,ht,1,1)(3,xt,2,0,"mat-icon"),s()()}if(e&2){let t=o.$implicit;c("lngLat",k(2,Ct,t.longitude,t.latitude)),r(2),m(t.stopLetter?2:3)}}var ct=(()=>{class e{stops=f.required();bounds=R(()=>{let t=this.stops().map(e.toMapBounds).reduce(e.getBounds);return e.toLngLatBounds(t)});map=null;click(t){console.log("Clicking stop",t)}static toMapBounds=t=>({swLng:t.longitude,swLat:t.latitude,neLng:t.longitude,neLat:t.latitude});static toLngLatBounds=t=>new C.LngLatBounds(new C.LngLat(t.swLng,t.swLat),new C.LngLat(t.neLng,t.neLat));static getBounds=(t,n)=>({swLng:Math.min(t.swLng,n.swLng),swLat:Math.min(t.swLat,n.swLat),neLng:Math.max(t.neLng,n.neLng),neLat:Math.max(t.neLat,n.neLat)});static \u0275fac=function(n){return new(n||e)};static \u0275cmp=b({type:e,selectors:[["app-route-map"]],inputs:{stops:[1,"stops"]},decls:6,vars:14,consts:[[3,"mapLoad","maxBounds","fitBounds","fitBoundsOptions","attributionControl","canvasContextAttributes"],["mglAttribution","","position","top-right",3,"compact"],["mglGeolocate","","position","bottom-right",3,"positionOptions"],["mglNavigation","","position","bottom-right"],[3,"lngLat"],[1,"marker",3,"click"]],template:function(n,i){n&1&&(a(0,"mgl-map",0),_("mapLoad",function(dt){return i.map=dt}),u(1,"mgl-control",1)(2,"mgl-control",2)(3,"mgl-control",3),M(4,bt,4,5,"mgl-marker",4,vt),s()),n&2&&(G("https://tiles.openfreemap.org/styles/bright"),c("maxBounds",D(9,ut,-.7))("fitBounds",i.bounds())("fitBoundsOptions",O(11,_t))("attributionControl",!1)("canvasContextAttributes",O(12,gt)),r(),c("compact",!0),r(),c("positionOptions",O(13,ft)),r(2),L(i.stops()))},dependencies:[ot,nt,it,at,st,S,rt],styles:["mgl-map[_ngcontent-%COMP%]{width:100%;height:100%}.marker[_ngcontent-%COMP%]{min-width:3em;height:3em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:50%;font-size:.8em}"]})}return e})();var Mt=e=>["../",e],Lt=(e,o)=>["/stop",e,o],wt=(e,o)=>o.id;function yt(e,o){e&1&&(a(0,"a",5)(1,"mat-icon"),d(2,"compare_arrows"),s()())}function Ot(e,o){if(e&1&&(a(0,"a",8),u(1,"app-bus-stop",9),s()),e&2){let t=o.$implicit;p(3);let n=g(0);c("routerLink",k(2,Lt,t.id,n.data.lineId)),r(),c("stop",t)}}function Dt(e,o){if(e&1&&(a(0,"a",1)(1,"div",2),d(2),s(),a(3,"div",3)(4,"div",4)(5,"small"),d(6,"from"),s(),a(7,"div"),d(8),s()(),l(9,yt,3,0,"a",5),a(10,"div",4)(11,"small"),d(12,"to"),s(),a(13,"div"),d(14),s()()()(),u(15,"app-route-map",6),a(16,"div",7),M(17,Ot,2,5,"a",8,wt),s()),e&2){let t=p(2),n=g(0);c("routerLink",n.data.isOutboundOnly?null:D(7,Mt,t.reverseDirection())),q("title",n.data.isOutboundOnly?null:"Switch route direction"),r(2),y(" ",n.data.lineName," "),r(6),T(n.data.from),r(),m(n.data.isOutboundOnly?-1:9),r(5),T(n.data.to),r(),c("stops",n.data.stops),r(2),L(n.data.stops)}}function kt(e,o){e&1&&u(0,"app-loading")}function Rt(e,o){if(e&1){let t=w();a(0,"app-error",10),_("onRefresh",function(){h(t);let i=p(2);return x(i.refresherSubject.next())}),s()}if(e&2){p(2);let t=g(0);c("errorData",t.error)}}function St(e,o){if(e&1&&l(0,Dt,19,9)(1,kt,1,0,"app-loading")(2,Rt,1,1,"app-error",0),e&2){p();let t=g(0);m(t.state==="done"?0:t.state==="loading"?1:t.state==="error"?2:-1)}}var Qt=(()=>{class e{busRouteService=V(Z);routeId=f.required();routeId$=E(this.routeId);direction=f.required();direction$=E(this.direction);reverseDirection=R(()=>this.direction()==="outbound"?"inbound":"outbound");refresherSubject=new F(void 0);refresher$=this.refresherSubject.asObservable().pipe(B(t=>console.log("refreshing")));viewModel$=this.refresher$.pipe(P(t=>j([this.routeId$,this.direction$])),B(t=>console.log("Latest values",t)),P(([t,n])=>this.busRouteService.details(t,n).pipe($(i=>({state:"done",data:i})),N(i=>(console.error("Unable to find route details",i),I({state:"error",error:i}))),A({state:"loading"}))));static \u0275fac=function(n){return new(n||e)};static \u0275cmp=b({type:e,selectors:[["app-bus-route-details"]],inputs:{routeId:[1,"routeId"],direction:[1,"direction"]},decls:3,vars:4,consts:[[3,"errorData"],[1,"header",3,"routerLink"],[1,"badge"],[1,"destinations"],[1,"destination"],[1,"reverse"],[3,"stops"],[1,"content"],[3,"routerLink"],[3,"stop"],[3,"onRefresh","errorData"]],template:function(n,i){if(n&1&&(z(0),U(1,"async"),l(2,St,3,1)),n&2){let v=H(W(1,1,i.viewModel$));r(2),m(v?2:-1)}},dependencies:[et,K,S,X,Q,Y,tt,ct,J],styles:[".header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:1em;margin-bottom:2em;color:#000;text-decoration:none}.header[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{min-width:3em;height:2em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:.5em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:1em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .destination[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:700;word-break:break-word}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .reverse[_ngcontent-%COMP%]{display:flex;color:#fff;background-color:#195b92;padding:.3em;border-radius:50%}app-route-map[_ngcontent-%COMP%]{display:block;width:100%;height:500px}.content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:.7em 0;display:block}.content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:inherit}"]})}return e})();export{Qt as RouteDetailsComponent};

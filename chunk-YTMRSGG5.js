import{a as Z}from"./chunk-FWKNEKYG.js";import{a as _t,b as ot,c as nt,d as it,e as rt,f as at,g as ct,h as st,i as pt,j as dt}from"./chunk-R25AMFRN.js";import{$ as v,$b as K,Ab as L,Cb as J,D as N,Db as U,Hb as S,Ia as q,Ja as u,Ka as _,Mb as f,N as A,Na as M,O as P,Oa as y,Pa as s,Qa as a,R as F,Ra as c,Sa as m,Wa as w,Y as V,Ya as O,_a as d,_b as W,aa as b,dd as k,e as ut,fd as Y,hd as tt,id as et,k as I,kc as T,lb as G,na as r,nb as p,nc as Q,ob as E,p as $,pb as D,s as B,sc as X,t as j,tb as z,ub as H,va as x,vb as C,yb as g,zb as h}from"./chunk-NVYEZAQB.js";var R=ut(_t());var ft=t=>[t,51.2,.4,51.8],Ct=()=>({padding:40}),ht=()=>({preserveDrawingBuffer:!0}),vt=()=>({enableHighAccuracy:!0}),bt=t=>({type:"LineString",coordinates:t}),xt=()=>({"line-join":"round","line-cap":"round"}),Mt=()=>({"line-color":"#195b92","line-width":5}),yt=(t,n)=>[t,n],wt=(t,n)=>n.id;function Ot(t,n){if(t&1&&p(0),t&2){let e=d().$implicit;D(" ",e.stopLetter," ")}}function Dt(t,n){t&1&&(a(0,"mat-icon"),p(1,"directions_bus"),c())}function Lt(t,n){if(t&1){let e=w();a(0,"mgl-marker",7)(1,"div",8),O("click",function(){let i=v(e).$implicit,l=d();return b(l.click(i.id))}),u(2,Ot,1,1)(3,Dt,2,0,"mat-icon"),c()()}if(t&2){let e=n.$implicit;s("lngLat",L(2,yt,e.longitude,e.latitude)),r(2),_(e.stopLetter?2:3)}}var lt=(()=>{class t{stops=f.required();bounds=S(()=>{let e=this.stops()[0].longitude,o=this.stops()[0].latitude,i=new R.LngLat(e,o);return this.stops().map(l=>[l.longitude,l.latitude]).reduce((l,mt)=>l.extend(mt),new R.LngLatBounds(i,i))});path=f.required();click(e){console.log("Clicking stop",e)}static \u0275fac=function(o){return new(o||t)};static \u0275cmp=x({type:t,selectors:[["app-route-map"]],inputs:{stops:[1,"stops"],path:[1,"path"]},decls:9,vars:21,consts:[[3,"maxBounds","fitBounds","fitBoundsOptions","attributionControl","canvasContextAttributes"],["mglAttribution","","position","top-right",3,"compact"],["mglGeolocate","","position","bottom-right",3,"positionOptions"],["mglNavigation","","position","bottom-right"],["id","pathSource"],[3,"geometry"],["id","route","type","line","source","pathSource",3,"layout","paint"],[3,"lngLat"],[1,"marker",3,"click"]],template:function(o,i){o&1&&(a(0,"mgl-map",0),m(1,"mgl-control",1)(2,"mgl-control",2)(3,"mgl-control",3),a(4,"mgl-geojson-source",4),m(5,"mgl-feature",5),c(),m(6,"mgl-layer",6),M(7,Lt,4,5,"mgl-marker",7,wt),c()),o&2&&(G("https://tiles.openfreemap.org/styles/bright"),s("maxBounds",h(12,ft,-.7))("fitBounds",i.bounds())("fitBoundsOptions",g(14,Ct))("attributionControl",!1)("canvasContextAttributes",g(15,ht)),r(),s("compact",!0),r(),s("positionOptions",g(16,vt)),r(3),s("geometry",h(17,bt,i.path())),r(),s("layout",g(19,xt))("paint",g(20,Mt)),r(),y(i.stops()))},dependencies:[nt,ot,ct,at,it,st,pt,dt,k,rt],styles:["mgl-map[_ngcontent-%COMP%]{width:100%;height:100%}.marker[_ngcontent-%COMP%]{min-width:3em;height:3em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:50%;font-size:.8em}"]})}return t})();var St=t=>["../",t],kt=(t,n)=>["/stop",t,n],Rt=(t,n)=>n.id;function Pt(t,n){t&1&&(a(0,"a",5)(1,"mat-icon"),p(2,"compare_arrows"),c()())}function Ft(t,n){if(t&1&&(a(0,"a",8),m(1,"app-bus-stop",9),c()),t&2){let e=n.$implicit;d(3);let o=C(0);s("routerLink",L(2,kt,e.id,o.data.lineId)),r(),s("stop",e)}}function Et(t,n){if(t&1&&(a(0,"a",1)(1,"div",2),p(2),c(),a(3,"div",3)(4,"div",4)(5,"small"),p(6,"from"),c(),a(7,"div"),p(8),c()(),u(9,Pt,3,0,"a",5),a(10,"div",4)(11,"small"),p(12,"to"),c(),a(13,"div"),p(14),c()()()(),m(15,"app-route-map",6),a(16,"div",7),M(17,Ft,2,5,"a",8,Rt),c()),t&2){let e=d(2),o=C(0);s("routerLink",o.data.isOutboundOnly?null:h(8,St,e.reverseDirection())),q("title",o.data.isOutboundOnly?null:"Switch route direction"),r(2),D(" ",o.data.lineName," "),r(6),E(o.data.from),r(),_(o.data.isOutboundOnly?-1:9),r(5),E(o.data.to),r(),s("stops",o.data.stops)("path",o.data.path),r(2),y(o.data.stops)}}function Tt(t,n){t&1&&m(0,"app-loading")}function It(t,n){if(t&1){let e=w();a(0,"app-error",10),O("onRefresh",function(){v(e);let i=d(2);return b(i.refresherSubject.next())}),c()}if(t&2){d(2);let e=C(0);s("errorData",e.error)}}function $t(t,n){if(t&1&&u(0,Et,19,10)(1,Tt,1,0,"app-loading")(2,It,1,1,"app-error",0),t&2){d();let e=C(0);_(e.state==="done"?0:e.state==="loading"?1:e.state==="error"?2:-1)}}var oe=(()=>{class t{busRouteService=V(Z);routeId=f.required();routeId$=T(this.routeId);direction=f.required();direction$=T(this.direction);reverseDirection=S(()=>this.direction()==="outbound"?"inbound":"outbound");refresherSubject=new I(void 0);refresher$=this.refresherSubject.asObservable().pipe(F(e=>console.log("refreshing")));viewModel$=this.refresher$.pipe(P(e=>j([this.routeId$,this.direction$])),F(e=>console.log("Latest values",e)),P(([e,o])=>this.busRouteService.details(e,o).pipe(B(i=>({state:"done",data:i})),N(i=>(console.error("Unable to find route details",i),$({state:"error",error:i}))),A({state:"loading"}))));static \u0275fac=function(o){return new(o||t)};static \u0275cmp=x({type:t,selectors:[["app-bus-route-details"]],inputs:{routeId:[1,"routeId"],direction:[1,"direction"]},decls:3,vars:4,consts:[[3,"errorData"],[1,"header",3,"routerLink"],[1,"badge"],[1,"destinations"],[1,"destination"],[1,"reverse"],[3,"stops","path"],[1,"content"],[3,"routerLink"],[3,"stop"],[3,"onRefresh","errorData"]],template:function(o,i){if(o&1&&(z(0),J(1,"async"),u(2,$t,3,1)),o&2){let l=H(U(1,1,i.viewModel$));r(2),_(l?2:-1)}},dependencies:[et,K,k,X,Q,Y,tt,lt,W],styles:[".header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:1em;margin-bottom:2em;color:#000;text-decoration:none}.header[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{min-width:3em;height:2em;display:flex;align-items:center;justify-content:center;background-color:#c33;color:#fff;font-weight:700;border-radius:.5em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:space-between;gap:1em}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .destination[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{font-weight:700;word-break:break-word}.header[_ngcontent-%COMP%]   .destinations[_ngcontent-%COMP%]   .reverse[_ngcontent-%COMP%]{display:flex;color:#fff;background-color:#195b92;padding:.3em;border-radius:50%}app-route-map[_ngcontent-%COMP%]{display:block;width:100%;height:500px}.content[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:.7em 0;display:block}.content[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:inherit}"]})}return t})();export{oe as RouteDetailsComponent};

import{O as m,U as l,Y as s,gd as d,s as r}from"./chunk-NVYEZAQB.js";var S=(()=>{class o{tflService=s(d);findByName(i){return this.tflService.findStops(i).pipe(r(t=>{if(!t.matches.length)throw new Error("Bus stop not found");return t.matches.map(e=>e.id)}),m(t=>this.tflService.listStopPoints(t)),r(t=>t.map(e=>e.children.length?e.children:e).flat().filter(o.isBusStopPoint).map(o.toStopListItem)))}findBySmsCode(i){return this.tflService.findStops(i).pipe(r(t=>t.matches.map(e=>e.id)),m(t=>this.tflService.listStopPoints(t).pipe(r(e=>e.map(n=>n.children.length?n.children:n).flat().sort((n,a)=>o.stopIdMatchesSortFn(n,a,t[0])).map(o.toStopListItem)))))}findByLocation(i,t,e){return this.tflService.findStopsNear(i,t,e).pipe(r(n=>n.stopPoints.map(o.toStopListItem)))}static stopIdMatchesSortFn=(i,t,e)=>i.id===e?-1:t.id===e?1:0;static isBusStopPoint(i){let t=i.lineModeGroups.find(e=>e.modeName==="bus")?.lineIdentifier??[];return i.lines.map(e=>e.id).filter(e=>t.includes(e)).length>0}static toStopListItem=i=>({id:i.id,commonName:i.commonName,stopLetter:i.stopLetter,lines:i.lines.map(t=>({id:t.id,name:t.name})),towards:i.additionalProperties.find(t=>t.key==="Towards")?.value,latitude:i.lat,longitude:i.lon});details(i){return this.tflService.stopPointDetails(i).pipe(r(t=>{t=t.children.find(n=>n.naptanId===i)??t;let e=t.lineModeGroups.find(n=>n.modeName==="bus")?.lineIdentifier??[];return{id:i,stopLetter:t.stopLetter,towards:t.additionalProperties.find(n=>n.key==="Towards")?.value,commonName:t.commonName,lines:t.lines.map(n=>({id:n.id,name:n.name})).filter(n=>e.includes(n.id)),latitude:t.lat,longitude:t.lon}}))}arrivals(i){return this.tflService.stopPointArrivals(i).pipe(r(t=>t.map(e=>({id:e.tripId,lineId:e.lineId,lineName:e.lineName,destinationName:e.destinationName,timeToStation:e.timeToStation})).sort(o.arrivalSortFn)))}static arrivalSortFn=(i,t)=>i.timeToStation-t.timeToStation;timetable(i,t){return this.tflService.stopPointTimetable(t,i).pipe(r(e=>o.toStopTimetable(e.timetable.departureStopId,e.lineId,e.timetable.routes[0])))}static toStopTimetable=(i,t,e)=>({stopId:i,lineId:t,schedules:e.schedules.map(n=>({name:n.name,arrivals:n.knownJourneys.map(a=>({hour:a.hour,minute:a.minute}))}))});static \u0275fac=function(t){return new(t||o)};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{S as a};
